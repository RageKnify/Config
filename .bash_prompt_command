#!/bin/bash

RET=$1

parse_git_branch() {
	git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/(\1)/'
}

ERRMSG=""

if [[ $RET != '0' ]]; then
	ERRMSG=' $RET'
fi

if [ $HOSTNAME = "TP-JP.Arch" ]; then
	# TP
	if [ "$(pgrep VirtualBoxVM)" != "" ]; then
		PROMPT_SYMBOL="$(tput setab 2)⋉"	# TP with VM
	else
		PROMPT_SYMBOL="⋉"						# TP without VM
	fi
else
	# not TP
	PROMPT_SYMBOL="$(tput setab 1)⋉"		# VM
fi

echo "\[$(tput bold)\]\[$(tput setaf 1)\][\[$(tput setaf 3)\]\u\[$(tput setaf 2)\]@\
\[$(tput setaf 4)\]\h \[$(tput setaf 5)\]\w\[$(tput setaf 1)\]]\
\[$(tput setaf 2)\]$(parse_git_branch)\
\[$(tput setaf 1)\]$ERRMSG \
\[$(tput setaf 7)\]$PROMPT_SYMBOL \
\[$(tput sgr0)\]"
